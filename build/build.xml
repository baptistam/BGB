<project name="Best Global Brands" default="build">

    <target name="build" depends="clean, prepare, phpunit, phpmd" />

    <target name="clean">
        <echo message="Cleaning up build directory" />
        <delete dir="logs" />
    </target>

    <target name="prepare">
        <echo message="Preparing build directory" />
        <mkdir dir="logs/phpunit" />
        <mkdir dir="logs/phpmd"/>
    </target>

    <target name="phpunit">
        <echo message="Running unit tests" />
        <phpunit haltonfailure="true" printsummary="true" >
            <formatter todir="logs/phpunit" type="xml" outfile="phpunit.xml" />
            <batchtest>
                <fileset dir="../tests">
                    <include name="*Test.php" />
                </fileset>
            </batchtest>
        </phpunit>

        <phpunitreport infile="logs/phpunit/phpunit.xml"
                       styledir="../vendor/phing/phing/etc"
                       format="noframes"
                       todir="logs/phpunit" />
    </target>

    <target name="phpmd">
        <echo message="Running mess detector" />
        <phpmd allowedFileExtensions="php5" rulesets="codesize,controversial,design,naming,unusedcode">
            <fileset dir="../">
                <include name="*.php5" />
            </fileset>
            <formatter type="xml" outfile="logs/phpmd/pmd.xml"/>
        </phpmd>
    </target>

</project>