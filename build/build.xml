<project name="Best Global Brands" default="build">

    <target name="build" depends="clean, prepare, phpunit, phpmd" />

    <target name="clean">
        <echo message="Cleaning up build directory" />
        <delete dir="logs" />
    </target>

    <target name="prepare">
        <echo message="Preparing build directory" />
        <mkdir dir="logs/phpunit" />
        <mkdir dir="logs/phpmd"/>
    </target>

    <target name="phpunit">
        <echo message="Running unit tests" />
        <phpunit haltonfailure="true" printsummary="true" >
            <formatter todir="logs/phpunit" type="xml" outfile="phpunit.xml" />
            <batchtest>
                <fileset dir="../tests">
                    <include name="*Test.php" />
                </fileset>
            </batchtest>
        </phpunit>

        <phpunitreport infile="logs/phpunit/phpunit.xml"
                       styledir="../vendor/phing/phing/etc"
                       format="noframes"
                       todir="logs/phpunit" />
    </target>

    <taskdef name="phpmd" classname="org.phpmd.ant.PHPMDTask"/>

    <target name="phpmd">
        <phpmd rulesetfiles="unusedcode" failOnRuleViolation="on">
            <formatter type="xml" toFile="logs/phpmd/phpmd.xml" />
            <fileset dir="../">
                <include name="*.php5" />
            </fileset>
        </phpmd>
    </target>
</project>